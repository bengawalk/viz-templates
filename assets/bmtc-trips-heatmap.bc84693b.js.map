{"version":3,"file":"bmtc-trips-heatmap.bc84693b.js","sources":["../../src/bmtc-trips-heatmap/main.jsx"],"sourcesContent":["import * as React from \"react\";\nimport { createRoot } from \"react-dom/client\";\nimport _ from \"lodash\";\nimport mapboxgl from \"mapbox-gl\";\nimport '@material-design-icons/font/filled.css';\n\nimport busData from \"./bmtc.csv\";\n\nimport { MAPBOX_TOKEN } from \"../utils/constants\";\n\nmapboxgl.accessToken = MAPBOX_TOKEN;\n\nconst mapData = {\n  \"type\": \"FeatureCollection\",\n  features: _.map(busData, b => ({\n    type: \"Feature\",\n    \"id\": b.stop,\n    \"properties\": {\n      \"id\": b.stop,\n      \"routes\": b.routes,\n      \"trips\": b.trips,\n    },\n    \"geometry\": {\n      \"type\": \"Point\",\n      \"coordinates\": [b.lon, b.lat]\n    },\n  })),\n};\n\n// console.log(mapData);\n\nclass Container extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      lat: \"12.9737\",\n      lng: \"77.6081\",\n      zoom : \"10.39\",\n    };\n    this.mapContainer = React.createRef();\n    this.autoplayInterval = null;\n  }\n\n  componentDidMount() {\n    this.initMap();\n    this.map?.on(\"load\", () => {\n      this.renderMapData();\n      this.addMapEvents();\n    });\n  }\n\n  initMap = () => {\n    const { lng, lat, zoom } = this.state;\n    const map = new mapboxgl.Map({\n      container: this.mapContainer.current,\n      style: \"mapbox://styles/mapbox/streets-v11\",\n      center: [lng, lat],\n      zoom: zoom,\n      // minZoom: 10,\n      // maxZoom: 18,\n    });\n    map.dragRotate.disable();\n    map.touchZoomRotate.disableRotation();\n    this.map = map;\n  };\n\n  renderMapData = () => {\n    this.map.addSource('bustrips', {\n      'type': 'geojson',\n      'data': mapData\n    });\n\n    this.map.addLayer(\n      {\n        'id': 'bus-trips-heat',\n        'type': 'heatmap',\n        'source': 'bustrips',\n        'paint': {\n          'heatmap-weight': ['interpolate', ['linear'], ['get', 'trips'], 0, 0, 1000, 1],\n          'heatmap-intensity': ['interpolate', ['linear'], ['zoom'], 0, 0.1, 100, 1],\n          'heatmap-color': [\n            'interpolate', ['linear'], ['heatmap-density'],\n            0, 'rgba(33,102,172,0)',\n            0.2, 'rgb(103,169,207)',\n            0.4, 'rgb(209,229,240)',\n            0.6, 'rgb(253,219,199)',\n            0.8, 'rgb(239,138,98)',\n            1, 'rgb(178,24,43)'\n          ],\n          'heatmap-radius': ['interpolate', ['linear'], ['zoom'], 0, 2, 9, 20],\n          'heatmap-opacity': ['interpolate', ['linear'], ['zoom'], 5, 0, 12, 0.8]\n        }\n      },\n      // 'bustrips'\n    );\n\n    this.map.addLayer({\n      'id': 'busstops',\n      'type': 'circle',\n      'source': 'bustrips',\n      'minzoom': 12.5,\n      'paint': {\n        'circle-color': '#4264fb',\n        'circle-radius': 6,\n        'circle-stroke-width': 2,\n        'circle-stroke-color': '#ffffff'\n      }\n    });\n\n  }\n\n  addMapEvents = () => {\n    this.map.on(\"move\", () => {\n      this.setState({\n        lng: this.map.getCenter().lng.toFixed(4),\n        lat: this.map.getCenter().lat.toFixed(4),\n        zoom: this.map.getZoom().toFixed(2),\n      });\n    });\n\n    const popup = new mapboxgl.Popup({\n      closeButton: true,\n      closeOnClick: false\n    });\n\n    this.map.on('mouseenter', 'busstops', (e) => {\n      this.map.getCanvas().style.cursor = 'pointer';\n\n      const coordinates = e.features[0].geometry.coordinates.slice();\n      const {\n        id,\n        trips,\n        routes,\n      } = e.features[0].properties;\n\n\n      while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {\n        coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;\n      }\n\n      popup\n        .setLngLat(coordinates)\n        .setHTML(`<div class=\"bustrips-popup\">\n    <h3>${id}</h3>\n    <p>${trips} trips<br />${routes} routes</p>\n</div>`)\n        .addTo(this.map);\n    });\n\n    this.map.on('mouseleave', 'places', () => {\n      this.map.getCanvas().style.cursor = '';\n      popup.remove();\n    });\n  }\n\n  render() {\n    return (\n      <div id=\"flyover-viz-wrapper\">\n        <div id=\"flyover-viz-map\" ref={this.mapContainer} />\n      </div>\n    );\n  }\n}\n\nconst root = createRoot(document.getElementById(\"root\"));\nroot.render(<Container />);\n"],"names":["mapboxgl","MAPBOX_TOKEN","mapData","_","busData","b","Container","React.Component","props","__publicField","lng","lat","zoom","map","popup","e","coordinates","id","trips","routes","React.createRef","_a","React.createElement","root","createRoot"],"mappings":"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"}